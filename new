using System;
using System.Collections.Generic;
using System.Linq;

public static List<ScanPointXYZ> OrderCornersXY(IReadOnlyList<ScanPointXYZ> pts)
{
    if (pts == null || pts.Count != 4) throw new ArgumentException("Need exactly 4 points.");
    var cx = pts.Average(p => p.X);
    var cy = pts.Average(p => p.Y);

    var ccw = pts.Select(p => (p, ang: Math.Atan2(p.Y - cy, p.X - cx)))
                 .OrderBy(t => t.ang)
                 .Select(t => t.p)
                 .ToList();

    // pick a deterministic start: "top-left" in XY (min Y then min X)
    // (If your Y axis increases downward like image coords, flip this to max Y)
    int i0 = ccw.Select((p, i) => (p, i))
                .OrderBy(t => t.p.Y).ThenBy(t => t.p.X)
                .First().i;

    return ccw.Skip(i0).Concat(ccw.Take(i0)).ToList();
}